---
external: false
title: 事务
date: 2023-06-26
---

# 一、事务操作（事务概念）

## 1. 什么事务

### （1） 事务是数据库操作最基本单元，逻辑上一组操作，要么都成功，如果有一个失败所有操作都失败 

### （2） 典型场景：银行转账 

> lucy 转账100元 给mary                          
> lucy少100，mary多100                         

## 2. 事务四个特性（ACID）

### (1) 原子性 
### (2) 一致性 
### (3) 隔离性 
### (4) 持久性

# 二、事务操作（搭建事务操作环境）

![事务操作业务](/assets/AOP/事务操作业务.png)

## 1. 创建数据库表，添加记录

![创建数据库表](/assets/AOP/创建数据库表.png)

## 2. 创建service，搭建dao，完成对象创建和注入关系

### (1) service注入dao，在dao注入JdbcTemplate，在JdbcTemplate注入DataSource

```java
@Service 
public class UserService { 
    //注入dao 
    @Autowired 
    private UserDao userDao; 
} 
@Repository 
public class UserDaoImpl implements UserDao { 
    @Autowired 
 
 
    private JdbcTemplate jdbcTemplate; 
}
```

## 3. 在dao创建两个方法：多钱和少钱的方法，在service创建方法（转账的方法）

```java
@Repository 
public class UserDaoImpl implements UserDao { 
 
    @Autowired 
    private JdbcTemplate jdbcTemplate; 
 
    //lucy转账100给mary 
    //少钱 
    @Override 
    public void reduceMoney() { 
        String sql = "update t_account set money=money-? where username=?"; 
        jdbcTemplate.update(sql,100,"lucy"); 
    } 
 
    //多钱 
    @Override 
    public void addMoney() { 
        String sql = "update t_account set money=money+? where username=?"; 
        jdbcTemplate.update(sql,100,"mary"); 
    } 
} 
 
@Service 
public class UserService { 
    //注入dao 
    @Autowired 
    private UserDao userDao; 
 
    //转账的方法 
    public void accountMoney() { 
        //lucy少100 
        userDao.reduceMoney(); 
 
        //mary多100 
        userDao.addMoney(); 
    } 
} 
```

## 4. 上面代码，如果正常执行没有问题的，但是如果代码执行过程中出现异常，有问题

![转账的方法](/assets/AOP/转账的方法.png)

### (1) 上面问题如何解决呢？  

> **使用事务进行解决**                        

### (2) 事务操作过程 

![事务的操作过程](/assets/AOP/事务的操作过程.png)




